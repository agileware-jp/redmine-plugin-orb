description: Download Redmine << parameters.redmine_version >>
parameters:
  cache_key_prefix:
    description: prefix of cache key
    type: string
    default: redmine-plugin-commands-download
  redmine_version:
    description: version of Redmine
    type: string
steps:
  - restore_cache:
      keys:
        - '<< parameters.cache_key_prefix >>-<< parameters.redmine_version >>'
  - run:
      name: Download Redmine << parameters.redmine_version >>
      command: |
        set -e
        if [ << parameters.redmine_version >> = trunk ]; then
          svn co --non-interactive --config-option servers:global:ssl-authority-files=<(curl -sL https://www.gandi.net/static/CAs/GandiStandardSSLCA2.pem) https://svn.redmine.org/redmine/trunk redmine-trunk
          exit
        fi
        if [ ! -d redmine-<< parameters.redmine_version >> ]; then
          curl https://redmine.org/releases/redmine-<< parameters.redmine_version >>.tar.gz | tar zx
        fi
  - save_cache:
      key: '<< parameters.cache_key_prefix >>-<< parameters.redmine_version >>'
      paths: redmine-<< parameters.redmine_version >>
